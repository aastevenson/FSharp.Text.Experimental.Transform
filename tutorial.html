<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Tutorial
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="A library used to parse and transform structured text"/>
    <meta name="author" content="Andrew Stevenson"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="/FSharp.Text.Experimental.Transform/content/style.css" />
    <script type="text/javascript" src="/FSharp.Text.Experimental.Transform/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/aastevenson/FSharp.Text.Experimental.Transform">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/FSharp.Text.Experimental.Transform/index.html">FSharp.Text.Experimental.Transform</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Tutorial" class="anchor" href="#Tutorial">Tutorial</a></h1>
<p>This tutorial introduces the essential components of a text transformation and works through a
simple JSON transformation task step by step. The tutorial is broken down into the following steps:</p>
<ol>
<li><a href="#Define-a-grammar-for-the-input-text">Define a grammar for the input text</a></li>
<li><a href="#Identify-the-nonterminal-target">Identify the nonterminal target</a></li>
<li><a href="#Write-the-transformation-function">Write the transformation function</a></li>
<li><a href="#Write-the-main-pipeline">Write the main pipeline</a></li>
<li><a href="#Format-the-output">Format the output</a></li>
</ol>
<p>We will be transforming the JSON sample below to add an empty string default property to every JSON string value.
For example, a key-value pair such as <code>"foo" : "bar"</code> will become <code>"foo" : { "value" : "bar", "default" : "" }</code>.</p>
<p>Here is the sample before and after the transformation:
<table>
<tr>
<th>Before</th><th>After</th>
</tr>
<td></p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">{<span class="s">&quot;widget&quot;</span><span class="o">:</span> {
    <span class="s">&quot;debug&quot;</span><span class="o">:</span> <span class="s">&quot;on&quot;</span>,
    <span class="s">&quot;window&quot;</span><span class="o">:</span> {
        <span class="s">&quot;title&quot;</span><span class="o">:</span> <span class="s">&quot;Sample Konfabulator Widget&quot;</span>,
        <span class="s">&quot;name&quot;</span><span class="o">:</span> <span class="s">&quot;main_window&quot;</span>,
        <span class="s">&quot;width&quot;</span><span class="o">:</span> <span class="n">500</span>,
        <span class="s">&quot;height&quot;</span><span class="o">:</span> <span class="n">500</span>
    }
}}
</code></pre></td>
</tr>
</table>
</td>
<td>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">{<span class="s">&quot;widget&quot;</span><span class="o">:</span> {
    <span class="s">&quot;debug&quot;</span><span class="o">:</span> {
        <span class="s">&quot;value&quot;</span> <span class="o">:</span> <span class="s">&quot;on&quot;</span>,
        <span class="s">&quot;default&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span>
    },
    <span class="s">&quot;window&quot;</span><span class="o">:</span> {
        <span class="s">&quot;title&quot;</span><span class="o">:</span> {
            <span class="s">&quot;value&quot;</span> <span class="o">:</span> <span class="s">&quot;Sample Konfabulator Widget&quot;</span>,
            <span class="s">&quot;default&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span>
        },
        <span class="s">&quot;name&quot;</span><span class="o">:</span> {
            <span class="s">&quot;value&quot;</span> <span class="o">:</span> <span class="s">&quot;main_window&quot;</span>,
            <span class="s">&quot;default&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span>
        },
        <span class="s">&quot;width&quot;</span><span class="o">:</span> <span class="n">500</span>,
        <span class="s">&quot;height&quot;</span><span class="o">:</span> <span class="n">500</span>
    }
}}
</code></pre></td>
</tr>
</table>
</td>
</tr>
</table>
<h2><a name="Define-a-grammar-for-the-input-text" class="anchor" href="#Define-a-grammar-for-the-input-text">Define a grammar for the input text</a></h2>
<p>In this section we define a general JSON grammar. We could define a schema-specific grammar, but that is what the
<a href="http://fsharp.github.io/FSharp.Data/library/JsonProvider.html">JSON type provider</a> is for
so we'll stick with a general JSON grammar. A grammar is made up of multiple <em>productions</em>,
where each production has the form <code>Nonterminal : definition;</code>, and the start of the grammar is identified by the
special nonterminal 'Program'. (See more about the <a href="grammarsyntax.html">grammar syntax</a>)</p>
<p>We can begin our grammar construction by examining our JSON sample and noting any patterns or repetitions. One
obvious pattern is the idea of a key-value pair. We note the key is always a string literal but the value can
vary, so we capture this observation with a production: <code>KeyValue: Stringlit ':' Value;</code>. This library provides
a default definition for Stringlit, but we must provide our own definition for what is a Value. Looking back at the
sample we note that a Value can be a string literal, a number, or something enclosed in <code>{</code> <code>}</code> which we'll call
an Object. This leads to another production: <code>Value: Stringlit | Num | Object;</code>. We continue this process until
we've described all the structures in the sample. Below is the full grammar with comments describing each production.</p>
<pre>
Program     :   Value;                  % the beginning of the program is a Value
Value       :   Stringlit               % a Value is a string literal, number, or Object
            |   Num
            |   Object;
Object      :   '{' KeyValue,* '}';     % an Object is comma-separated KeyValues surrounded by curly braces
KeyValue    :   Stringlit ':' Value;    % a KeyValue is a string literal and Value separated by a colon
</pre>
<p>That's all that's needed to parse our JSON sample! This library contains
<a href="grammarsyntax.html#Lexer-rules">default definitions for common token classes</a>
like <em>Stringlit</em> and <em>Num</em> so you don't need to define them yourself, but you can always override them if you want. Grammar
definitions can either be placed into a standalone text file or embedded in an F# string literal, like so:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="i">FSharp</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">Text</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="i">Experimental</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="i">Transform</span>

[&lt;<span onmouseout="hideTip(event, 'fs1', 7)" onmouseover="showTip(event, 'fs1', 7)" class="t">Literal</span>&gt;]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs7', 8)" onmouseover="showTip(event, 'fs7', 8)" class="i">grammar</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    Program     :   Value;                  % the beginning of the program is a Value</span>
<span class="s">    Value       :   Stringlit               % a Value is a string literal, number, or Object</span>
<span class="s">                |   Num</span>
<span class="s">                |   Object;</span>
<span class="s">    Object      :   &#39;{&#39; KeyValue,* &#39;}&#39;;     % an Object is zero or more comma-separated KeyValues surrounded by curly braces</span>
<span class="s">    KeyValue    :   Stringlit &#39;:&#39; Value;    % a KeyValue is a string literal and Value separated by a colon</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs8', 9)" onmouseover="showTip(event, 'fs8', 9)" class="t">Json</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs9', 10)" onmouseover="showTip(event, 'fs9', 10)" class="t">GrammarProvider</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs7', 11)" onmouseover="showTip(event, 'fs7', 11)" class="i">grammar</span><span class="o">&gt;</span>
</code></pre></td>
</tr>
</table>
<h2><a name="Identify-the-nonterminal-target" class="anchor" href="#Identify-the-nonterminal-target">Identify the nonterminal target</a></h2>
<p>When writing a transformation it's important to think about the most basic grammar unit being transformed. Recall the general form
of our transformation is changing <code>"bar"</code> to <code>{ "value": "bar", "default": "" }</code>, representing a transformation from a
Stringlit to an Object. <strong>To find the appropriate nonterminal target for our transformation, we choose the nonterminal that
is the nearest ancestor of both a Stringlit and an Object, i.e. a Value.</strong> This means our transformation function will
have the signature <code>Value -&gt; Value</code>.</p>
<h2><a name="Write-the-transformation-function" class="anchor" href="#Write-the-transformation-function">Write the transformation function</a></h2>
<p>As mentioned at the end of the previous step, our transformation function has the signature <code>Value -&gt; Value</code>. Since the purpose of
our transformation is to add a default property to a string value, we will name our function "addDefault". Here is the template of
a typical transformation function, omitting parts that vary:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs10', 12)" onmouseover="showTip(event, 'fs10', 12)" class="f">addDefault</span> (<span onmouseout="hideTip(event, 'fs11', 13)" onmouseover="showTip(event, 'fs11', 13)" class="i">inp</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs8', 14)" onmouseover="showTip(event, 'fs8', 14)" class="t">Json</span><span class="o">.</span><span class="c">(*nonterminal target goes here*)</span> ) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs11', 15)" onmouseover="showTip(event, 'fs11', 15)" class="i">inp</span><span class="o">.</span><span class="i">TryMatch</span><span class="o">&lt;</span> <span class="c">(*pattern to match goes here*)</span> <span class="o">&gt;</span>()
    <span class="o">|&gt;</span> <span class="k">function</span> 
        | <span onmouseout="hideTip(event, 'fs12', 16)" onmouseover="showTip(event, 'fs12', 16)" class="p">Some</span> <span onmouseout="hideTip(event, 'fs13', 17)" onmouseover="showTip(event, 'fs13', 17)" class="i">b</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs8', 18)" onmouseover="showTip(event, 'fs8', 18)" class="i">Json</span><span class="o">.</span><span class="c">(*nonterminal target*)</span><span class="o">.</span><span class="i">Construct</span><span class="o">&lt;</span><span class="c">(*replacement pattern*)</span><span class="o">&gt;</span>( <span class="c">(*replacement arguments*)</span> )
        | <span onmouseout="hideTip(event, 'fs14', 19)" onmouseover="showTip(event, 'fs14', 19)" class="p">None</span>   <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs11', 20)" onmouseover="showTip(event, 'fs11', 20)" class="i">inp</span>
</code></pre></td>
</tr>
</table>
<p>And here is the template above filled in with our transformation details:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs15', 21)" onmouseover="showTip(event, 'fs15', 21)" class="f">addDefault</span> (<span onmouseout="hideTip(event, 'fs16', 22)" onmouseover="showTip(event, 'fs16', 22)" class="i">inp</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs8', 23)" onmouseover="showTip(event, 'fs8', 23)" class="i">Json</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 24)" onmouseover="showTip(event, 'fs17', 24)" class="i">Value</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs16', 25)" onmouseover="showTip(event, 'fs16', 25)" class="i">inp</span><span class="o">.</span><span class="i">TryMatch</span><span class="o">&lt;</span><span class="s">&quot;stringValue$Stringlit&quot;</span><span class="o">&gt;</span>()     <span class="c">// target only Values that are string literals</span>
    <span class="o">|&gt;</span> <span class="k">function</span>
        | <span onmouseout="hideTip(event, 'fs12', 26)" onmouseover="showTip(event, 'fs12', 26)" class="p">Some</span> <span onmouseout="hideTip(event, 'fs13', 27)" onmouseover="showTip(event, 'fs13', 27)" class="i">b</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs8', 28)" onmouseover="showTip(event, 'fs8', 28)" class="i">Json</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 29)" onmouseover="showTip(event, 'fs17', 29)" class="i">Value</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 30)" onmouseover="showTip(event, 'fs17', 30)" class="i">Construct</span><span class="o">&lt;</span><span class="s">&quot;&quot;&quot; { &quot;value&quot; : $Stringlit, &quot;default&quot; : &quot;&quot; } &quot;&quot;&quot;</span><span class="o">&gt;</span>(<span onmouseout="hideTip(event, 'fs13', 31)" onmouseover="showTip(event, 'fs13', 31)" class="i">b</span><span class="o">.</span><span class="i">StringValue</span>)   <span class="c">// replace with an Object</span>
        | <span onmouseout="hideTip(event, 'fs14', 32)" onmouseover="showTip(event, 'fs14', 32)" class="p">None</span>   <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs16', 33)" onmouseover="showTip(event, 'fs16', 33)" class="i">inp</span>
</code></pre></td>
</tr>
</table>
<p>This function first tries to match the input argument <code>inp</code> against the pattern <code>stringValue$Stringlit</code>. This means "try to
interpret <code>inp</code> (of type Value) as a Stringlit and, if successful, bind that Stringlit to the name <code>stringValue</code>." (For more
information about patterns, see <a href="patterns.html">Patterns, Holes, and Binding Types</a>). It might be helpful to think of this as a
downcast test, from a nonterminal higher in the grammar to a nonterminal lower in the grammar (similar to how, in object-oriented
programming, one can downcast an Animal object to a Dog object).</p>
<p>If no match is found (i.e. the Value passed in is not a Stringlit) then we leave it unchanged; this is the None case. If we find a
match, then any variables that were bound in the process are available via the <code>b</code> variable. We therefore construct a new Value and
specify its form by the static parameter of the <code>Construct</code> method. This replacement pattern <code>{ "value" : $Stringlit, "default" : "" }</code>
contains <code>$Stringlit</code>, signifying a placeholder of type Stringlit. The <code>Construct</code> method's arguments provide values for such
placeholders, in the same order they appear in the replacement pattern, therefore we provide <code>b.StringValue</code> which is the string literal
that was bound in the original pattern match.</p>
<h2><a name="Write-the-main-pipeline" class="anchor" href="#Write-the-main-pipeline">Write the main pipeline</a></h2>
<p>This is where the main execution happens. We parse the input file, apply our transformation function to the resulting parse tree,
then finally unparse back into text and print it out:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs8', 34)" onmouseover="showTip(event, 'fs8', 34)" class="t">Json</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 35)" onmouseover="showTip(event, 'fs17', 35)" class="i">ParseString</span> <span onmouseout="hideTip(event, 'fs2', 36)" onmouseover="showTip(event, 'fs2', 36)" class="i">sample</span>                     <span class="c">// parse sample</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs8', 37)" onmouseover="showTip(event, 'fs8', 37)" class="i">Json</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 38)" onmouseover="showTip(event, 'fs17', 38)" class="i">Program</span><span class="o">.</span><span class="i">ApplyOnePass</span> <span onmouseout="hideTip(event, 'fs15', 39)" onmouseover="showTip(event, 'fs15', 39)" class="i">addDefault</span>     <span class="c">// apply transformation function</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs8', 40)" onmouseover="showTip(event, 'fs8', 40)" class="t">Json</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 41)" onmouseover="showTip(event, 'fs17', 41)" class="i">Pretty</span>                              <span class="c">// unparse to string</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs18', 42)" onmouseover="showTip(event, 'fs18', 42)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s">&quot;</span>                             <span class="c">// print to stdout</span>
</code></pre></td>
</tr>
</table>
<p>The <code>ApplyOnePass</code> method traverses the parse tree once, applying the <code>addDefault</code> transformation whenever appropriate. This
approach is similar to the <code>map</code> function familiar to all functional programmers, except that the transformation function
(<code>addDefault</code>) is only applied to subtrees that match its target type (<code>Json.Value</code>). This library's API allows one to write
the same pipeline above but in a more object-oriented style:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs8', 43)" onmouseover="showTip(event, 'fs8', 43)" class="t">Json</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 44)" onmouseover="showTip(event, 'fs17', 44)" class="i">ParseString</span>(<span onmouseout="hideTip(event, 'fs2', 45)" onmouseover="showTip(event, 'fs2', 45)" class="i">sample</span>)<span class="o">.</span><span class="i">ApplyOnePass</span>(<span onmouseout="hideTip(event, 'fs15', 46)" onmouseover="showTip(event, 'fs15', 46)" class="i">addDefault</span>)<span class="o">.</span><span class="i">ToString</span>()
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs18', 47)" onmouseover="showTip(event, 'fs18', 47)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s">&quot;</span>
</code></pre></td>
</tr>
</table>
<p>You can use whichever style you prefer or even a mix of both. I prefer the first style because it's closer to idiomatic F#.</p>
<h2><a name="Format-the-output" class="anchor" href="#Format-the-output">Format the output</a></h2>
<p>If we execute the code above we'll get this output:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">{ <span class="s">&quot;widget&quot;</span> <span class="o">:</span> { <span class="s">&quot;debug&quot;</span> <span class="o">:</span> { <span class="s">&quot;value&quot;</span> <span class="o">:</span> <span class="s">&quot;on&quot;</span>, <span class="s">&quot;default&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span> }, <span class="s">&quot;window&quot;</span> <span class="o">:</span> { <span class="s">&quot;title&quot;</span> <span class="o">:</span> { <span class="s">&quot;value&quot;</span> <span class="o">:</span> <span class="s">&quot;Sample Konfabulator Widget&quot;</span>, 
<span class="s">&quot;default&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span> }, <span class="s">&quot;name&quot;</span> <span class="o">:</span> { <span class="s">&quot;value&quot;</span> <span class="o">:</span> <span class="s">&quot;main_window&quot;</span>, <span class="s">&quot;default&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span> }, <span class="s">&quot;width&quot;</span> <span class="o">:</span> <span class="n">500</span>, <span class="s">&quot;height&quot;</span> <span class="o">:</span> <span class="n">500</span> } } }
</code></pre></td>
</tr>
</table>
<p>This output is correct but lacks formatting. We can annotate our grammar with formatting cues to pretty print the
output text. There are 4 <a href="grammarsyntax.html#Formatting-cues">formatting cues</a> we can use in our grammar:</p>
<ul>
<li>indent <code>&gt;</code></li>
<li>dedent <code>&lt;</code></li>
<li>newline <code>/</code></li>
<li>space <code>_</code></li>
</ul>
<p>In a pretty-printed JSON document each key-value pair starts on a new line -- so we annotate our KeyValue production with
a newline cue:
<pre>KeyValue : / Stringlit ':' Value;</pre>
In addition, JSON text is indented after <code>{</code>, dedented before <code>}</code>, and a new line appears after a KeyValue list. We can use <code>&gt;</code> and
<code>&lt;</code> for indent and dedent respectively, and use <code>/</code> after the KeyValue list:
<pre>Object : '{' &gt; KeyValue,* / < '}';</pre>
Here is the full grammar with these formatting cues:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="text">Program     :   Value;
Value       :   Stringlit
            |   Num
            |   Object;
Object      :   '{'
            &gt;       KeyValue,*  /
            &lt;   '}';
KeyValue    :   / Stringlit ':' Value;
</code></pre></td></tr></table>
<p>With these formatting cues in place, the output text now appears properly:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">{
    <span class="s">&quot;widget&quot;</span> <span class="o">:</span> {
        <span class="s">&quot;debug&quot;</span> <span class="o">:</span> {
            <span class="s">&quot;value&quot;</span> <span class="o">:</span> <span class="s">&quot;on&quot;</span>,
            <span class="s">&quot;default&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span>
        },
        <span class="s">&quot;window&quot;</span> <span class="o">:</span> {
            <span class="s">&quot;title&quot;</span> <span class="o">:</span> {
                <span class="s">&quot;value&quot;</span> <span class="o">:</span> <span class="s">&quot;Sample Konfabulator Widget&quot;</span>,
                <span class="s">&quot;default&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span>
            },
            <span class="s">&quot;name&quot;</span> <span class="o">:</span> {
                <span class="s">&quot;value&quot;</span> <span class="o">:</span> <span class="s">&quot;main_window&quot;</span>,
                <span class="s">&quot;default&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span>
            },
            <span class="s">&quot;width&quot;</span> <span class="o">:</span> <span class="n">500</span>,
            <span class="s">&quot;height&quot;</span> <span class="o">:</span> <span class="n">500</span>
        }
    }
}
</code></pre></td>
</tr>
</table>
<h2><a name="Afterthoughts" class="anchor" href="#Afterthoughts">Afterthoughts</a></h2>
<p>This example demonstrates some of the advantages of tree-based transformation over other forms of text transformation.
For instance, using regular expressions to transform the JSON string literal value <code>"bar"</code> into the JSON object value
<code>{ "value" : "bar", "default" : "" }</code> could inadvertantly transform JSON keys named <code>"bar"</code> in the same way. But a
typed parse tree distinguishes between a key and a value, and this difference can be used to selectively target one or
the other during the transformation.</p>
<p>This library also ensures that transformations will always produce well-formed output according to the given grammar.
In this JSON example, that means most attempts to produce malformed JSON will be compile errors in your program. This
is one of the core <a href="philosophy.html">design goals</a> of this library.</p>
<p>We encourage you to read further about this library:</p>
<ul>
<li><a href="api.html">API reference</a></li>
<li><a href="grammarsyntax.html">Grammar syntax reference</a></li>
<li><a href="parser.html">How to use the parser</a></li>
<li><a href="idioms.html">Common transformation idioms</a></li>
</ul>

<div class="tip" id="fs1">Multiple items<br />type LiteralAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; LiteralAttribute<br /><br />Full name: Microsoft.FSharp.Core.LiteralAttribute<br /><br />--------------------<br />new : unit -&gt; LiteralAttribute</div>
<div class="tip" id="fs2">val sample : string<br /><br />Full name: Tutorial.sample</div>
<div class="tip" id="fs3">Multiple items<br />namespace FSharp<br /><br />--------------------<br />namespace Microsoft.FSharp</div>
<div class="tip" id="fs4">namespace FSharp.Text</div>
<div class="tip" id="fs5">namespace FSharp.Text.Experimental</div>
<div class="tip" id="fs6">namespace FSharp.Text.Experimental.Transform</div>
<div class="tip" id="fs7">val grammar : string<br /><br />Full name: Tutorial.grammar</div>
<div class="tip" id="fs8">type Json = GrammarProvider&lt;...&gt;<br /><br />Full name: Tutorial.Json</div>
<div class="tip" id="fs9">type GrammarProvider<br /><br />Full name: FSharp.Text.Experimental.Transform.GrammarProvider</div>
<div class="tip" id="fs10">val addDefault : inp:Json -&gt; Json<br /><br />Full name: Tutorial.addDefault</div>
<div class="tip" id="fs11">val inp : Json</div>
<div class="tip" id="fs12">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs13">val b : obj</div>
<div class="tip" id="fs14">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs15">val addDefault : inp:&#39;a -&gt; &#39;a<br /><br />Full name: Tutorial.addDefault</div>
<div class="tip" id="fs16">val inp : &#39;a</div>
<div class="tip" id="fs17"></div>
<div class="tip" id="fs18">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>

        </div>
        <div class="span3">
          <img src="/FSharp.Text.Experimental.Transform/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">FSharp.Text.Experimental.Transform</li>
            <li><a href="/FSharp.Text.Experimental.Transform/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/FSharp.Text.Experimental.Transform">Get Library via NuGet</a></li>
            <li><a href="http://github.com/aastevenson/FSharp.Text.Experimental.Transform">Source Code on GitHub</a></li>
            <li><a href="/FSharp.Text.Experimental.Transform/license.html">License</a></li>
            <li><a href="/FSharp.Text.Experimental.Transform/release-notes.html">Release Notes</a></li>
            
            <li class="nav-header">Getting started</li>
            <li><a href="/FSharp.Text.Experimental.Transform/tutorial.html">Sample tutorial</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="/FSharp.Text.Experimental.Transform/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/aastevenson/FSharp.Text.Experimental.Transform"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
