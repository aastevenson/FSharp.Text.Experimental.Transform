<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Design Goals and Philosophy
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="A library used to parse and transform structured text"/>
    <meta name="author" content="Andrew Stevenson"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="/FSharp.Text.Experimental.Transform/content/style.css" />
    <script type="text/javascript" src="/FSharp.Text.Experimental.Transform/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/aastevenson/FSharp.Text.Experimental.Transform">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/FSharp.Text.Experimental.Transform/index.html">FSharp.Text.Experimental.Transform</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Design-Goals-and-Philosophy" class="anchor" href="#Design-Goals-and-Philosophy">Design Goals and Philosophy</a></h1>
<p>All ideas are influenced by those that come before and this library is no exception.
FSharp.Text.Experimental.Transform is heavily influenced by the source transformation language
<a href="txl.ca">TXL</a> and adopts much of its philosophy. F# is a great candidate for a reimplementation
of TXL because they both share a functional paradigm, immutable values, and static typing. But
<em>type providers</em> are the killer F# feature that puts it over the top for the requirements of
this particular library.</p>
<p>The design goals of this library align with those of F# in many ways. In particular, parse trees
in this library are both <em>immutable</em> and <em>statically-typed</em>. Immutability means transformations on
parse trees do not mutate those parse trees, but rather creates new parse trees combining elements
of existing parse trees such that common subtrees can be shared. Static typing refers to the idea
that each parse tree (and subtree) has a type known at compile-time, and more importantly has a
<em>shape</em> consistent with that type. This property of strongly <em>shaped</em> parse trees is the key
philosophy of this library, and we describe in the following section how this property is enforced
at compile-time.</p>
<h2><a name="Strongly-shaped-parse-trees" class="anchor" href="#Strongly-shaped-parse-trees">Strongly-shaped parse trees</a></h2>
<p>When text is parsed according to a context-free grammar the resulting parse tree takes on a
shape defined by the grammar. This library, which performs tree-based transformations, takes great
care to ensure transformed trees maintain a shape that is still consistent with the grammar. This means
no matter how much you transform a JSON parse tree the result will be valid JSON, or no matter
how you transform a C# parse tree the result will be a valid C# program. Furthermore, a major design
goal of this library is to enforce this constraint at compile-time making it impossible to execute
library code producing malformed output.</p>
<p>These goals are achieved using F#'s type provider feature to map parse trees to types, then
letting F#'s type system do the work of enforcing shape/type constraints. The following table shows
this mapping from grammar operator to F# type.</p>
<table border="1" cellpadding="25">
<tr>
<th>Grammar Operator and Example</th><th>Corresponding Provided F# Type</th>
</tr>
<tr>
<td>
Concatenation
<pre>Concat: X Y</pre>
</td>
<td>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="t">Concat</span>(<span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">x</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs1', 5)" onmouseover="showTip(event, 'fs1', 5)" class="t">X</span>, <span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="i">y</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs2', 7)" onmouseover="showTip(event, 'fs2', 7)" class="t">Y</span>) <span class="o">=</span>
    <span class="k">member</span> <span class="i">__</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs6', 8)" onmouseover="showTip(event, 'fs6', 8)" class="i">X</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 9)" onmouseover="showTip(event, 'fs4', 9)" class="i">x</span>
    <span class="k">member</span> <span onmouseout="hideTip(event, 'fs7', 10)" onmouseover="showTip(event, 'fs7', 10)" class="i">__</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs8', 11)" onmouseover="showTip(event, 'fs8', 11)" class="i">Y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs5', 12)" onmouseover="showTip(event, 'fs5', 12)" class="i">y</span>
</code></pre></td>
</tr>
</table>
</td>
</tr>
<tr>
<td>Disjunction
<pre>Disj: X | Y</pre></td>
<td>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs9', 13)" onmouseover="showTip(event, 'fs9', 13)" class="t">Disj</span>(<span onmouseout="hideTip(event, 'fs10', 14)" onmouseover="showTip(event, 'fs10', 14)" class="i">choice</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 15)" onmouseover="showTip(event, 'fs11', 15)" class="t">Choice</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs1', 16)" onmouseover="showTip(event, 'fs1', 16)" class="t">X</span>, <span onmouseout="hideTip(event, 'fs2', 17)" onmouseover="showTip(event, 'fs2', 17)" class="t">Y</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">member</span> <span class="i">__</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 18)" onmouseover="showTip(event, 'fs12', 18)" class="i">Chosen</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 19)" onmouseover="showTip(event, 'fs10', 19)" class="i">choice</span>
</code></pre></td>
</tr>
</table>
</td>
</tr>
<tr>
<td>Optional
<pre>Opt: X?</pre></td>
<td>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs13', 20)" onmouseover="showTip(event, 'fs13', 20)" class="t">Opt</span>(<span onmouseout="hideTip(event, 'fs14', 21)" onmouseover="showTip(event, 'fs14', 21)" class="i">maybeX</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs1', 22)" onmouseover="showTip(event, 'fs1', 22)" class="t">X</span> <span onmouseout="hideTip(event, 'fs15', 23)" onmouseover="showTip(event, 'fs15', 23)" class="t">option</span>) <span class="o">=</span>
    <span class="k">member</span> <span class="i">__</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 24)" onmouseover="showTip(event, 'fs16', 24)" class="i">Value</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 25)" onmouseover="showTip(event, 'fs14', 25)" class="i">maybeX</span>
</code></pre></td>
</tr>
</table>
</td>
</tr>
<tr>
<td>Repetition
<pre>
Rep: X*
Rep: X+
Rep: X,*
Rep: X,+
</pre>
</td>
<td>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs17', 26)" onmouseover="showTip(event, 'fs17', 26)" class="t">Rep</span>(<span onmouseout="hideTip(event, 'fs18', 27)" onmouseover="showTip(event, 'fs18', 27)" class="i">repetitions</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs1', 28)" onmouseover="showTip(event, 'fs1', 28)" class="t">X</span> <span onmouseout="hideTip(event, 'fs19', 29)" onmouseover="showTip(event, 'fs19', 29)" class="t">list</span>) <span class="o">=</span>
    <span class="k">member</span> <span class="i">__</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 30)" onmouseover="showTip(event, 'fs20', 30)" class="i">Repetitions</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs18', 31)" onmouseover="showTip(event, 'fs18', 31)" class="i">repetitions</span>
</code></pre></td>
</tr>
</table>
</td>
</tr>
</table>
<p>One can see how, with this mapping, it is impossible to create a parse tree of type <code>Concat</code> with anything but
a subtree of type <code>X</code> and a subtree of type <code>Y</code>. F#'s built-in <code>Choice</code> type to represent disjunction is a
natural fit, but leads to the unfortunate
<a href="limitations.html#Grammar-disjunction-is-limited-to-7-alternatives">limitation</a> of disallowing more than 7
alternatives in a disjunctive clause.</p>
<p>The primary data structure used in this library is an abstract syntax tree, but trees are typically
cumbersome to express and visualize in code compared with strings. For example, consider these two
expressions of the same parse tree: <code>AssignStatement(Id("sum"), Add(Id("a"), Const(5))</code> vs. <code>sum &lt;- a + 5</code>.
The former has the advantage of being statically type-checked to ensure a valid tree shape, but the latter has
the advantage of clarity. Luckily, type providers allow for the best of both. In particular, static parameters
on provided methods allows for the extension of compile-time <em>shape</em> safety to
<a href="patterns.html">patterns and replacements</a>, greatly reducing the possibility of bugs in pattern strings
compared to the alternative of evaluating pattern strings at runtime.</p>
<h2><a name="Just-do-the-right-thing" class="anchor" href="#Just-do-the-right-thing">Just do the right thing</a></h2>
<p>Another design goal of this library is to <strong>make common tasks the default behaviour</strong> so it appears the library
"just does the right thing". Examples include:</p>
<ul>
<li>Ignoring whitespace by default while parsing</li>
<li>Interpret alphabetic grammar literals as keywords that get parsed separately from identifiers.</li>
<li>Having common token classes already defined: identifiers (<code>Id</code>), integers (<code>Int</code>), string literals (<code>Stringlit</code>), etc.</li>
<li>
Suppressing spaces around certain tokens during unparsing so output looks like <code>[1, 2, 3]</code> instead of 
<code>[ 1 , 2 , 3 ]</code>.
</li>
</ul>
<p>These are small, mostly invisible conveniences, but important for a good out-of-box user experience.</p>

<div class="tip" id="fs1">type X<br /><br />Full name: Philosophy.X</div>
<div class="tip" id="fs2">type Y<br /><br />Full name: Philosophy.Y</div>
<div class="tip" id="fs3">Multiple items<br />type Concat =<br />&#160;&#160;new : x:X * y:Y -&gt; Concat<br />&#160;&#160;member X : X<br />&#160;&#160;member Y : Y<br /><br />Full name: Philosophy.Concat<br /><br />--------------------<br />new : x:X * y:Y -&gt; Concat</div>
<div class="tip" id="fs4">val x : X</div>
<div class="tip" id="fs5">val y : Y</div>
<div class="tip" id="fs6">member Concat.X : X<br /><br />Full name: Philosophy.Concat.X</div>
<div class="tip" id="fs7">val __ : Concat</div>
<div class="tip" id="fs8">member Concat.Y : Y<br /><br />Full name: Philosophy.Concat.Y</div>
<div class="tip" id="fs9">Multiple items<br />type Disj =<br />&#160;&#160;new : choice:Choice&lt;X,Y&gt; -&gt; Disj<br />&#160;&#160;member Chosen : Choice&lt;X,Y&gt;<br /><br />Full name: Philosophy.Disj<br /><br />--------------------<br />new : choice:Choice&lt;X,Y&gt; -&gt; Disj</div>
<div class="tip" id="fs10">val choice : Choice&lt;X,Y&gt;</div>
<div class="tip" id="fs11">Multiple items<br />type Choice&lt;&#39;T1,&#39;T2&gt; =<br />&#160;&#160;| Choice1Of2 of &#39;T1<br />&#160;&#160;| Choice2Of2 of &#39;T2<br /><br />Full name: Microsoft.FSharp.Core.Choice&lt;_,_&gt;<br /><br />--------------------<br />type Choice&lt;&#39;T1,&#39;T2,&#39;T3&gt; =<br />&#160;&#160;| Choice1Of3 of &#39;T1<br />&#160;&#160;| Choice2Of3 of &#39;T2<br />&#160;&#160;| Choice3Of3 of &#39;T3<br /><br />Full name: Microsoft.FSharp.Core.Choice&lt;_,_,_&gt;<br /><br />--------------------<br />type Choice&lt;&#39;T1,&#39;T2,&#39;T3,&#39;T4&gt; =<br />&#160;&#160;| Choice1Of4 of &#39;T1<br />&#160;&#160;| Choice2Of4 of &#39;T2<br />&#160;&#160;| Choice3Of4 of &#39;T3<br />&#160;&#160;| Choice4Of4 of &#39;T4<br /><br />Full name: Microsoft.FSharp.Core.Choice&lt;_,_,_,_&gt;<br /><br />--------------------<br />type Choice&lt;&#39;T1,&#39;T2,&#39;T3,&#39;T4,&#39;T5&gt; =<br />&#160;&#160;| Choice1Of5 of &#39;T1<br />&#160;&#160;| Choice2Of5 of &#39;T2<br />&#160;&#160;| Choice3Of5 of &#39;T3<br />&#160;&#160;| Choice4Of5 of &#39;T4<br />&#160;&#160;| Choice5Of5 of &#39;T5<br /><br />Full name: Microsoft.FSharp.Core.Choice&lt;_,_,_,_,_&gt;<br /><br />--------------------<br />type Choice&lt;&#39;T1,&#39;T2,&#39;T3,&#39;T4,&#39;T5,&#39;T6&gt; =<br />&#160;&#160;| Choice1Of6 of &#39;T1<br />&#160;&#160;| Choice2Of6 of &#39;T2<br />&#160;&#160;| Choice3Of6 of &#39;T3<br />&#160;&#160;| Choice4Of6 of &#39;T4<br />&#160;&#160;| Choice5Of6 of &#39;T5<br />&#160;&#160;| Choice6Of6 of &#39;T6<br /><br />Full name: Microsoft.FSharp.Core.Choice&lt;_,_,_,_,_,_&gt;<br /><br />--------------------<br />type Choice&lt;&#39;T1,&#39;T2,&#39;T3,&#39;T4,&#39;T5,&#39;T6,&#39;T7&gt; =<br />&#160;&#160;| Choice1Of7 of &#39;T1<br />&#160;&#160;| Choice2Of7 of &#39;T2<br />&#160;&#160;| Choice3Of7 of &#39;T3<br />&#160;&#160;| Choice4Of7 of &#39;T4<br />&#160;&#160;| Choice5Of7 of &#39;T5<br />&#160;&#160;| Choice6Of7 of &#39;T6<br />&#160;&#160;| Choice7Of7 of &#39;T7<br /><br />Full name: Microsoft.FSharp.Core.Choice&lt;_,_,_,_,_,_,_&gt;</div>
<div class="tip" id="fs12">member Disj.Chosen : Choice&lt;X,Y&gt;<br /><br />Full name: Philosophy.Disj.Chosen</div>
<div class="tip" id="fs13">Multiple items<br />type Opt =<br />&#160;&#160;new : maybeX:X option -&gt; Opt<br />&#160;&#160;member Value : X option<br /><br />Full name: Philosophy.Opt<br /><br />--------------------<br />new : maybeX:X option -&gt; Opt</div>
<div class="tip" id="fs14">val maybeX : X option</div>
<div class="tip" id="fs15">type &#39;T option = Option&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.option&lt;_&gt;</div>
<div class="tip" id="fs16">member Opt.Value : X option<br /><br />Full name: Philosophy.Opt.Value</div>
<div class="tip" id="fs17">Multiple items<br />type Rep =<br />&#160;&#160;new : repetitions:X list -&gt; Rep<br />&#160;&#160;member Repetitions : X list<br /><br />Full name: Philosophy.Rep<br /><br />--------------------<br />new : repetitions:X list -&gt; Rep</div>
<div class="tip" id="fs18">val repetitions : X list</div>
<div class="tip" id="fs19">type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs20">member Rep.Repetitions : X list<br /><br />Full name: Philosophy.Rep.Repetitions</div>

        </div>
        <div class="span3">
          <img src="/FSharp.Text.Experimental.Transform/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">FSharp.Text.Experimental.Transform</li>
            <li><a href="/FSharp.Text.Experimental.Transform/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/FSharp.Text.Experimental.Transform">Get Library via NuGet</a></li>
            <li><a href="http://github.com/aastevenson/FSharp.Text.Experimental.Transform">Source Code on GitHub</a></li>
            <li><a href="/FSharp.Text.Experimental.Transform/license.html">License</a></li>
            <li><a href="/FSharp.Text.Experimental.Transform/release-notes.html">Release Notes</a></li>
            
            <li class="nav-header">Getting started</li>
            <li><a href="/FSharp.Text.Experimental.Transform/tutorial.html">Sample tutorial</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="/FSharp.Text.Experimental.Transform/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/aastevenson/FSharp.Text.Experimental.Transform"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
